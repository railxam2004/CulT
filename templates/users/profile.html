{% extends 'base.html' %}
{% block title %}Профиль{% endblock %}
{% block content %}
  <h2>Профиль {{ request.user.username }}</h2>
  <p><strong>Email:</strong> {{ request.user.email }}</p>
  <p><strong>Имя:</strong> {{ request.user.first_name }} {{ request.user.last_name }}</p>
  <p><strong>Телефон:</strong> {{ request.user.phone }}</p>
  {% if request.user.avatar %}
    <p><img src="{{ request.user.avatar.url }}" alt="Аватар" style="max-width:150px;"></p>
  {% endif %}

  {% if request.user.is_organizer %}
    <p><strong>Статус:</strong> Организатор ✅</p>
  {% else %}
    {% if has_active_app %}
      <p>Текущая заявка: <em>{{ last_active_app.get_status_display }}</em></p>
      {% if last_active_app.comment %}
        <p><strong>Комментарий модератора:</strong> {{ last_active_app.comment }}</p>
      {% endif %}
    {% else %}
      <p><a href="{% url 'users:organizer_request' %}">Подать заявку на статус организатора</a></p>

      {% if last_app %}
        {% if last_app.status == 'rejected' %}
          <p><small>Предыдущая заявка была отклонена{% if last_app.comment %}: {{ last_app.comment }}{% endif %}.</small></p>
        {% elif last_app.status == 'approved' %}
          <p><small>Ранее статус организатора был выдан и затем снят администратором. Вы можете подать новую заявку.</small></p>
        {% endif %}
      {% endif %}
    {% endif %}
  {% endif %}

  <p>
    <a href="{% url 'users:profile_edit' %}">Редактировать профиль</a> |
    <a href="{% url 'users:password_change' %}">Сменить пароль</a>
  </p>
{% endblock %}
