{% extends 'base.html' %}
{% block title %}Билеты — {{ event.title }}{% endblock %}
{% block content %}
<h1>Билеты — {{ event.title }}</h1>

<p>
  <a href="{% url 'tickets:scan_event' event.id %}">Перейти к сканеру для этого события</a> |
  <a href="{% url 'events:my_event_tickets_export' event.id %}">Экспорт CSV</a> |
  <a href="{% url 'events:my_list' %}">← Мои мероприятия</a>
</p>


{% if tickets %}
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Покупатель</th>
        <th>Тариф</th>
        <th>QR (hash)</th>
        <th>Статус</th>
        <th>Получен</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for t in tickets %}
        <tr>
          <td>{{ t.id }}</td>
          <td>{{ t.user.get_full_name|default:t.user.username }}</td>
          <td>{{ t.event_tariff.tariff.name }}</td>
          <td><code>{{ t.qr_hash|slice:":12" }}…</code></td>
          <td>{% if t.is_used %}<span style="color:#c00;">использован</span>{% else %}<span style="color:#080;">действителен</span>{% endif %}</td>
          <td>{{ t.created_at|date:"d.m.Y H:i" }}</td>
          <td>
            <form action="{% url 'tickets:toggle_used' t.id %}" method="post">
              {% csrf_token %}
              {% if t.is_used %}
                <button type="submit">Снять отметку</button>
              {% else %}
                <button type="submit">Отметить</button>
              {% endif %}
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>Пока нет билетов.</p>
{% endif %}
{% endblock %}
