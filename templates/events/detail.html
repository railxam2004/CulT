{% extends 'base.html' %}
{% block title %}{{ event.title }}{% endblock %}
{% block content %}
  <h1>{{ event.title }}</h1>
  {% comment %}Избранное — кнопка на карточке события{% endcomment %}
{% if user.is_authenticated %}
  {% if is_favorited %}
    <form action="{% url 'favorites:remove' event.id %}" method="post" style="display:inline;">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <button type="submit">★ В избранном (убрать)</button>
    </form>
  {% else %}
    <form action="{% url 'favorites:add' event.id %}" method="post" style="display:inline;">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <button type="submit">☆ В избранное</button>
    </form>
  {% endif %}
{% else %}
  <a href="{% url 'users:login' %}?next={{ request.path }}">Войдите</a>, чтобы добавить в избранное
{% endif %}

  <p><strong>Категория:</strong> {{ event.category.name }}</p>
  <p><strong>Дата и время:</strong> {{ event.starts_at|date:"d.m.Y H:i" }}</p>
  {% if event.duration_minutes %}
    <p><strong>Длительность:</strong> ~{{ event.duration_minutes }} мин.</p>
  {% endif %}
  <p><strong>Место:</strong> {{ event.location }}</p>
  {% if event.image %}
    <p><img src="{{ event.image.url }}" alt="{{ event.title }}" style="max-width:300px;"></p>
  {% endif %}
  <p>{{ event.description|linebreaks }}</p>

  <h3>Тарифы</h3>
{% if event.is_past %}
  <div style="padding:10px;border:1px solid #eee;border-radius:6px;background:#fafafa;margin:10px 0;">
    <strong>Событие уже прошло.</strong> Покупка билетов недоступна.
  </div>
{% else %}
  {% if tariffs %}
    <ul>
      {% for et in tariffs %}
        <li>
          {{ et.tariff.name }} — {{ et.price }} ₽
          (осталось: {{ et.remaining }})
          {% if user.is_authenticated %}
            <form action="{% url 'cart:add' et.id %}" method="post" style="display:inline;">
              {% csrf_token %}
              <input type="number" name="quantity" min="1" max="{{ et.remaining }}" value="1" style="width:60px;">
              <button type="submit">Купить</button>
            </form>
          {% else %}
            <span> — <a href="{% url 'users:login' %}?next={{ request.path }}">Войдите</a>, чтобы купить</span>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Тарифы не указаны.</p>
  {% endif %}
{% endif %}
{% endblock %}