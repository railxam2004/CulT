{% extends 'base.html' %}
{% block title %}–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è{% endblock %}

{% block content %}
<h1>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>

<!-- üîç –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<form method="get" class="filters" style="margin-bottom: 1rem;">
  <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–æ–ø–∏—Å–∞–Ω–∏—é" value="{{ q }}" style="width:220px;">

  <select name="category" aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
    {% for c in categories %}
      <option value="{{ c.slug }}" {% if c.slug == current_category %}selected{% endif %}>{{ c.name }}</option>
    {% endfor %}
  </select>

  <input type="date" name="date_from" value="{{ date_from }}" aria-label="–°">
  <input type="date" name="date_to" value="{{ date_to }}" aria-label="–ü–æ">

  <input type="text" name="city" placeholder="–ì–æ—Ä–æ–¥/–ª–æ–∫–∞—Ü–∏—è" value="{{ city }}" style="width:180px;">

  <select name="sort" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
    <option value="soon" {% if sort == 'soon' %}selected{% endif %}>–°–∫–æ—Ä–æ</option>
    <option value="popular" {% if sort == 'popular' %}selected{% endif %}>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
    <option value="cheap" {% if sort == 'cheap' %}selected{% endif %}>–î–µ—à–µ–≤–ª–µ</option>
  </select>

  <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
  <a href="{% url 'events:list' %}">–°–±—Ä–æ—Å–∏—Ç—å</a>
</form>

<hr>

<!-- üé≠ –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
{% if events %}
  <div class="event-list" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px,1fr)); gap:16px;">
    {% for e in events %}
      <article class="event-card"
               style="border:1px solid #ddd; border-radius:10px; padding:12px; background:#fafafa; transition:box-shadow .2s;">
        <a href="{% url 'events:detail' e.slug %}"
           style="text-decoration:none; color:inherit;">
          <h3 style="margin:0 0 6px 0; font-size:18px;">{{ e.title }}</h3>
          <p style="margin:0; color:#666; font-size:14px;">
            {{ e.category.name }} ‚Ä¢ {{ e.starts_at|date:"d.m.Y H:i" }}
          </p>
          {% if e.location %}
            <p style="margin:4px 0 6px; color:#777; font-size:13px;">{{ e.location }}</p>
          {% endif %}
          {% if e.min_price %}
            <p style="font-weight:bold; color:#333;">–æ—Ç {{ e.min_price }} ‚ÇΩ</p>
          {% endif %}
        </a>

        <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
          {% if user.is_authenticated %}
            {% if e.id in favorite_ids %}
              <form action="{% url 'favorites:remove' e.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button title="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
                        style="background:none; border:none; color:#e7b400; font-size:20px; cursor:pointer;">‚òÖ</button>
              </form>
            {% else %}
              <form action="{% url 'favorites:add' e.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"
                        style="background:none; border:none; color:#ccc; font-size:20px; cursor:pointer;">‚òÜ</button>
              </form>
            {% endif %}
          {% endif %}
        </div>
      </article>
    {% endfor %}
  </div>

  <!-- üìÑ –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
  {% if events.has_other_pages %}
    <nav class="pagination" aria-label="–ü–∞–≥–∏–Ω–∞—Ü–∏—è" style="margin-top: 1rem; text-align:center;">
      {% if events.has_previous %}
        <a href="?{{ base_qs }}{% if base_qs %}&{% endif %}page={{ events.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
      {% endif %}
      <span style="margin:0 .5rem;">–°—Ç—Ä. {{ events.number }} –∏–∑ {{ events.paginator.num_pages }}</span>
      {% if events.has_next %}
        <a href="?{{ base_qs }}{% if base_qs %}&{% endif %}page={{ events.next_page_number }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
      {% endif %}
    </nav>
  {% endif %}

{% else %}
  <p>–ü–æ–∫–∞ –Ω–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.</p>
{% endif %}

{% if user.is_authenticated and user.is_organizer %}
  <p style="margin-top:1.5rem;">
    <a href="{% url 'events:create' %}" class="btn">+ –°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
  </p>
{% endif %}

{% endblock %}
